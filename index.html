<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>QCM Java 21</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="home-page">
<div class="container">
    <div class="card">
        <h1>Pr√©paration Certification Java 21</h1>
        <p>Choisissez un examen blanc :</p>

        <div class="exam-categories">
            <!-- Section D√©veloppement/Test -->
            <div class="category-section">
                <h2 class="category-title">üõ†Ô∏è D√©veloppement & Test</h2>
                <div class="exam-grid">
                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">DEV</span>
                                <h4>Exam for test purpose only</h4>
                            </div>
                        </div>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam1.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam1.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section H√©ritage & Polymorphisme -->
            <div class="category-section">
                <h2 class="category-title">üèóÔ∏è H√©ritage/Polymorphisme/Encapsulation/Overriding</h2>
                <div class="exam-grid">
                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">H1</span>
                                <h4>Examen blanc 1</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam5.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam5.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>

                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">H2</span>
                                <h4>Examen blanc 2</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam6.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam6.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>

                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">H3</span>
                                <h4>Examen blanc 3</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam7.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam7.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>

                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">H4</span>
                                <h4>Examen blanc 3 bis</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam-12-heritage_and_co.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam-12-heritage_and_co.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Collections & Streams -->
            <div class="category-section">
                <h2 class="category-title">üìä Collections & Streams </h2>
                <div class="exam-grid">
                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">C1</span>
                                <h4>Examen blanc 4</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam8.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam8.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>

                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">C2</span>
                                <h4>Examen blanc 5</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam9.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam9.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>

                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">C3</span>
                                <h4>Examen blanc 6</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam10.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam10.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>

                    <div class="exam-card compact">
                        <div class="exam-header">
                            <div class="exam-title-group">
                                <span class="exam-number">C4</span>
                                <h4>Examen blanc 7</h4>
                            </div>
                        </div>
                        <p class="exam-desc">20 questions ‚Ä¢ Special reduce</p>
                        <div class="exam-actions">
                            <a class="btn-mini" href="exam.html?exam=exam11.json&mode=exam">Examen</a>
                            <a class="btn-mini outline" href="exam.html?exam=exam11.json&mode=train">Entra√Ænement</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="progressManager.js"></script>
<script>
// Mapping global des examens avec leurs IDs
const examMappings = {
    'exam1.json': 'DEV',
    'exam5.json': 'H1',
    'exam6.json': 'H2',
    'exam7.json': 'H3',
    'exam-12-heritage_and_co.json': 'H4',
    'exam8.json': 'C1',
    'exam9.json': 'C2',
    'exam10.json': 'C3',
    'exam11.json': 'C4'
};

// Charger et afficher les badges de progression
document.addEventListener('DOMContentLoaded', function() {
    updateExamBadges();
    displayGlobalStats();
});

function updateExamBadges() {
    Object.entries(examMappings).forEach(([examId, cardId]) => {
        const badgeInfo = progressManager.getExamBadgeInfo(examId);
        updateExamCard(cardId, badgeInfo, examId);
    });
}

function updateExamCard(cardId, badgeInfo, examId) {
    // Trouver la carte par le num√©ro d'examen
    const examCards = document.querySelectorAll('.exam-card.compact');

    examCards.forEach(card => {
        const examNumber = card.querySelector('.exam-number');
        if (examNumber && examNumber.textContent === cardId) {
            // Ajouter le badge de statut
            let statusBadge = card.querySelector('.status-badge');
            if (!statusBadge) {
                statusBadge = document.createElement('div');
                statusBadge.className = 'status-badge';
                card.querySelector('.exam-header').appendChild(statusBadge);
            }

            statusBadge.innerHTML = `${badgeInfo.badge} <span>${badgeInfo.text}</span>`;
            statusBadge.style.color = badgeInfo.color;

            // Ajouter le score si disponible
            let scoreDisplay = card.querySelector('.score-display');
            if (!scoreDisplay) {
                scoreDisplay = document.createElement('div');
                scoreDisplay.className = 'score-display';
                card.insertBefore(scoreDisplay, card.querySelector('.exam-actions'));
            }

            if (badgeInfo.bestScore !== null && badgeInfo.bestScore > 0) {
                let scoreHTML = `<small>Meilleur: <strong>${badgeInfo.bestScore}%</strong></small>`;

                // Afficher la moyenne seulement s'il y a plus d'une tentative
                if (badgeInfo.attempts > 1 && badgeInfo.averageScore > 0) {
                    scoreHTML += `<small> ‚Ä¢ Moyenne: <strong>${badgeInfo.averageScore}%</strong></small>`;
                }

                if (badgeInfo.attempts > 1) {
                    scoreHTML += `<small> ‚Ä¢ ${badgeInfo.attempts} tentatives</small>`;
                }

                scoreDisplay.innerHTML = scoreHTML;
                scoreDisplay.style.display = 'block';

                // Ajouter le bouton reset pour cet examen
                let resetBtn = card.querySelector('.reset-exam-btn');
                if (!resetBtn) {
                    resetBtn = document.createElement('button');
                    resetBtn.className = 'reset-exam-btn';
                    resetBtn.innerHTML = 'üóëÔ∏è';
                    resetBtn.title = 'Supprimer les statistiques de cet examen';
                    card.querySelector('.exam-actions').appendChild(resetBtn);
                }

                // Ajouter l'event listener avec les bonnes donn√©es
                const examTitle = card.querySelector('h4').textContent;

                // Supprimer l'ancien listener et ajouter le nouveau
                resetBtn.replaceWith(resetBtn.cloneNode(true));
                resetBtn = card.querySelector('.reset-exam-btn');

                resetBtn.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    resetExamStats(examId, examTitle);
                };
            } else {
                scoreDisplay.style.display = 'none';

                // Supprimer le bouton reset s'il n'y a pas de stats
                const resetBtn = card.querySelector('.reset-exam-btn');
                if (resetBtn) {
                    resetBtn.remove();
                }
            }
        }
    });
}

function resetAllStats() {
    const confirmation = confirm(
        `‚ö†Ô∏è ATTENTION !\n\n√ätes-vous s√ªr de vouloir supprimer TOUTES vos statistiques ?\n\nCeci effacera d√©finitivement :\n‚Ä¢ Tous vos scores et moyennes\n‚Ä¢ Vos temps d'√©tude\n‚Ä¢ Votre historique complet\n\nCette action est irr√©versible !`
    );

    if (confirmation) {
        const secondConfirmation = confirm(
            "üö® DERNI√àRE CHANCE !\n\nConfirmez-vous vraiment la suppression de toutes vos donn√©es ?\n\nTapez OK pour confirmer la suppression compl√®te."
        );

        if (secondConfirmation) {
            progressManager.resetAllProgress();
            updateExamBadges();
            displayGlobalStats();

            // Notification de succ√®s
            alert("‚úÖ Toutes les statistiques ont √©t√© supprim√©es avec succ√®s !");
        }
    }
}

function resetExamStats(examId, examName) {
    console.log('Reset demand√© pour:', examId, examName);

    const confirmation = confirm(
        `‚ö†Ô∏è Supprimer les statistiques de "${examName}" ?\n\nCeci effacera :\n‚Ä¢ Vos scores et moyenne pour cet examen\n‚Ä¢ Votre temps d'√©tude pour cet examen\n‚Ä¢ Votre historique pour cet examen\n\nCette action est irr√©versible !`
    );

    if (confirmation) {
        console.log('Confirmation re√ßue, reset en cours...');
        const success = progressManager.resetExamProgress(examId);
        console.log('R√©sultat du reset:', success);

        if (success) {
            updateExamBadges();
            displayGlobalStats();
            alert(`‚úÖ Statistiques de "${examName}" supprim√©es !`);
        } else {
            alert("‚ùå Erreur lors de la suppression.");
        }
    }
}

function displayGlobalStats() {
    const stats = progressManager.getGlobalStats();

    // Ajouter une section de statistiques globales en haut
    const card = document.querySelector('.card');
    let statsSection = document.querySelector('.global-stats');

    if (!statsSection) {
        statsSection = document.createElement('div');
        statsSection.className = 'global-stats';
        card.insertBefore(statsSection, document.querySelector('.exam-categories'));
    }

    const hasAnyProgress = progressManager.getTotalExamsWithProgress() > 0;

    if (hasAnyProgress) {
        let statsHTML = '';

        if (stats.totalExamsAttempted > 0) {
            statsHTML = `
                <div class="stats-container">
                    <div class="stat-item">
                        <span class="stat-number">${stats.totalExamsCompleted}</span>
                        <span class="stat-label">Examens r√©ussis</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${stats.averageScore}%</span>
                        <span class="stat-label">Score moyen</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${progressManager.formatTime(stats.totalStudyTime)}</span>
                        <span class="stat-label">Temps d'√©tude</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${stats.bestScore}%</span>
                        <span class="stat-label">Meilleur score</span>
                    </div>
                </div>`;
        }

        statsSection.innerHTML = `
            ${statsHTML}
            <div class="reset-section">
                <button id="reset-all-btn" class="reset-btn">üóëÔ∏è Reset toutes les statistiques</button>
            </div>
        `;

        // Ajouter l'event listener pour le bouton reset global
        const resetBtn = document.getElementById('reset-all-btn');
        if (resetBtn) {
            resetBtn.addEventListener('click', resetAllStats);
        }
    } else {
        statsSection.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">Commencez votre premier examen pour voir vos statistiques !</p>';
    }
}
</script>
</body>
</html>
